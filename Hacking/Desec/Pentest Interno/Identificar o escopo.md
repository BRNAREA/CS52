<h1 align="center">Pentest Interno</h1>
<hr>

```ad-question
title: Oque eh pentest interno?

Normalmente pentest interno o cliente te contrata e voce vai la fisicamente ficar alocado na sede da empresa e vai se conectar dentro da rede via wireless ou a cabo na sua maquina, a ideia seria voce fazer a avaliacao da seguranca daquele ambiente dependendo do objetivo do pentest. No caso vamos fazer um pentest interno abaixo.
```

```ad-info

**Cliente**: GRUPO BUSINESS CORP
**TIPO DE PENTEST**: PENTEST INTERNO
**OBJETIVO**:AVALIAR A SEGURANCA PELA PERSPECTIVA DE UM USUARIO CONECTADO A REDE INTERNA.
**ESCOPO**:HOSTS DO DOMINIO LOCAL ORIONSCORP2
**TIPO**: PENTEST BLACKBOX
**REDE**: 172.16.1.0/24
**HOST PENTESTER**: 172.16.1.249
```

```ad-question
title: Porque identificar o escopo?
Muita das vezes precisamos saber os hosts do dominio local do orioncorp2 para focarmos apenas nesses hosts
```

Primeira coisa que a nos vamos fazer eh executar o [[Hacking/Ferramentas/Scanners/NMAP|NMAP]] 

```sh
nmap --open -v -sS 445 -Pn <IP>/24 -oG smb.txt
```

Porque a porta 445 ? Porque eh o SMB como o nosso alvo eh comprometer um dominio local , um AD enfim, a gente sabe que tem porta 445 aberta , entao ja queremos otimizar o nosso tempo ao inves de varrer toda nossa rede, varreremos apenas a porta 445 com hosts ativos.

Ao fazer isso ele vai fazer um scan mais rapido pois ele procura pela apenas 445 aberta

Agora gerado o arquivo smb.txt pra gente podemos filtrar ela

```sh
cat smb.txt | grep "up" | cut -d " " -f 2 > targets
```

Lembrando que sao o hosts que possuem smb ativos.

Agora que ja filtramos , podemos usar o nosso canitvete suico do <span style='color:var(--mk-color-red)'>crackmapexec</span> no protocolo <span style='color:var(--mk-color-teal)'>smb</span> no nosso <span style='color:var(--mk-color-orange)'>targets</span> pois sao somente esses hosts que desejam obter informacoes sobre o smb.

Agora ja conseguimos identificar quais hosts fazem parte do dominio alvo o <span style='color:var(--mk-color-yellow)'>ORIONSCORP2</span>. 

Se houver algum host com nome de `SERV` ou algo do tipo comecaremos por ele, vamos fazer um scaneamento basicao nele.

```sh
nmap -v --open -Pn<IP DO SERV>
```

Se vermos portas como `53, 445,389,88,3268` eh porque ele de fato eh um <span style='color:var(--mk-color-teal)'>AD</span> ou Servidor.

Entao espera se ele tem uma porta DNS aberta , quer dizer que ele faz resolucao DNS a gente pode fazer algumas pesquisas pro host

```sh
host <IP DO HOST LOCAL> <IP DO SERVIDOR>
```

Nesse momento ja reconhecemos o escopo. Oque podemos fazer agora , eh pegar esses enderecos IPs pra tentar buscar por vulnerabilidades , exploits , enumeracao , buscar por vetor de ataques ou ate mesmo as tecnicas que utilizamos como capturar hashes pela rede , que sera oque vamos fazer.

Usando o responder , vamos configurar para capturar apenas por esses hosts.
O arquivo de configuracao fica em <mark style='background:var(--mk-color-purple)'>/etc/responder/responder.conf</mark> , podemos configurar a opcao `RespondTo`

```
RespondTo = 172.16.1.243, 172.16.1.241, 172.16.1.253
```

